<html><head><title>Javascript Evaluator</title>
<style>
td {padding:0px}
table {border-collapse:collapse; width:100%}
body {background:lightyellow; font-family:Arial}
textarea {font-family:Lucida console; color:black; background:white; height:6in; width:100%}
</style>
<script>
cout = function(str) {
    document.getElementById("myResults").value += str;
}

cls = function() {
    document.getElementById("myResults").value = "";
}

myEval = function() {
    var str;
    var old = new Date().getTime();
    cls();
    try {
        with (Math) {
            str = eval(document.getElementById("myScript").value);
        }
    } catch(err) {
        str = err.name+" : "+err.message;
    }
    if (str != undefined) {cout(str)};
    document.getElementById("myTimer").innerHTML = "running time: "+(new Date().getTime()-old)+" ms";   
}
</script></head>

<body onload="myEval()">
<table><tr><td width=25%>
<span style="cursor:pointer; font-size:x-large" onmousedown="myEval()">Javascript Evaluator (Alt+K)</span></td>
<td width=75% align=right>
<span style="font-size:small" id="myTimer"></span></td></tr></table>

<table><tr><td width=15%>
<textarea id="myResults"></textarea></td>
<td width=85%>
<textarea id="myScript" onkeyup="if (event.keyCode==75 && event.altKey) myEval()">
var oldString = "81609,Feather Duster,198,92246,Lawn Chair Set,50,03854,Carrano C++ book,183,27408,Monsters, Inc. DVD,89";
var newString = "66284,Screwdriver,1000,81609,Feather Duster,195,92246,Lawn Chair Set,50,03490,Bedspread,87,27408,Monsters, Inc. DVD,89,40411,Hair Spray,380";
var diffString = ""; myN = 8;
var oldTable = [], matchTable = []; indexTable = []; lengthTable = []; diffTable = [];
var startTableOld = []; startTableNew = []; widthTable = []; 

function showTable(aTable){for (var i=0; i<aTable.length; i++){cout(aTable[i]+"\n")}};

function makeTable(aString, aTable, aColumn){
	var numberRows = Math.ceil(aString.length/aColumn);
	for (var i=0; i< numberRows; i++){aTable[i] = aString.substr(i*aColumn,aColumn)}
};

function makeMatch(aString,aTable,mTable,iTable){
for(var j=0;j<aTable.length;j++){
	for (var i=0; i<aString.length-myN;i++){
	if (aTable[j]==aString.substr(i,aTable[j].length)){mTable.push(i);iTable.push(j*myN);break;};
	};
};
};

function makeBounds(mTable,iTable,lTable,oTable,nTable,wTable,nString,oString){
for (var i=0;i<mTable.length;i++){lTable[i]=myN};
for (var i=mTable.length-1;i>0;i--){if (mTable[i]-mTable[i-1]==myN){lTable[i-1]=lTable[i]+lTable[i-1];lTable[i]=0}};
for (var i=0;i<lTable.length;i++){if (lTable[i]!=0){nTable.push(mTable[i]);oTable.push(iTable[i]);wTable.push(lTable[i])}};
for (var i=0;i<wTable.length;i++){
	lengthExt = wTable[i];
	for (var j=1; j<myN; j++){
	if (nString[nTable[i]+lengthExt+j]==oString[oTable[i]+lengthExt+j]){lengthExt=lengthExt+1}else{break};
	}
	leftExt = 0;
	for (var j=1; j<myN; j++){
	if (nString[nTable[i]-j]==oString[oTable[i]-j]){leftExt=leftExt+1}else{break};
	}
	wTable[i]=lengthExt+leftExt;oTable[i]=oTable[i]-leftExt;nTable[i]=nTable[i]-leftExt;
};
};

function makeDiff(oTable,nTable,wTable,dTable,nString){
if (nTable[0]!=0){dTable.push("A"+nTable[0]+":"+nString.substr(0,nTable[0]))};
for (var i=0; i<wTable.length-1;i++){
	dTable.push("C"+wTable[i]+","+oTable[i]);
	dTable.push("A"+(nTable[i+1]-nTable[i]-wTable[i])+":"+nString.substr((nTable[i]+wTable[i]),(nTable[i+1]-nTable[i]-wTable[i])));
};
dTable.push("C"+wTable[wTable.length-1]+","+oTable[wTable.length-1]);
var lastLength = nString.length-nTable[wTable.length-1]-wTable[wTable.length-1];
if (lastLength!=0){
	dTable.push("A"+lastLength+":"+nString.substr((nTable[wTable.length-1]+wTable[wTable.length-1]),lastLength));
};
};

makeTable(oldString,oldTable,myN);
showTable(oldTable);
makeMatch(newString,oldTable,matchTable,indexTable);
makeBounds(matchTable,indexTable,lengthTable,startTableOld,startTableNew,widthTable,newString,oldString);
makeDiff(startTableOld,startTableNew,widthTable,diffTable,newString);
diffString=diffTable.join("");
cout(diffString+"\n");
cout("Diff File :"+diffString.length);

</textarea></td></tr>
</table><span style="font-size:x-small">based on Peter Jipsen Online JavaScript Interpreter</span></body></html>